% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/tornadoSensitivity.R
\name{tornadoSensitivity}
\alias{tornadoSensitivity}
\title{Tornado Sensitivity for Deterministic NPV}
\usage{
tornadoSensitivity(
  Flow,
  Occurrence,
  Name,
  NominalRate,
  TerminalYear,
  FutureValue,
  Exit = TRUE,
  ShockSpec,
  FlowNameMap = NULL
)
}
\arguments{
\item{Flow}{Numeric vector of cash flows (length = n rows).}

\item{Occurrence}{Numeric vector of periods (1..T) for each cash flow; same length as \code{Flow}.}

\item{Name}{Character vector of flow labels (e.g., "Harvest Revenue", "Operating Expense"); same length as \code{Flow}.}

\item{NominalRate}{Numeric scalar, the discount rate (e.g., 0.05).}

\item{TerminalYear}{Integer terminal year at which the terminal value is applied.}

\item{FutureValue}{Numeric scalar, terminal value at \code{TerminalYear} (undiscounted).}

\item{Exit}{Logical; if \code{TRUE}, use present value for the terminal (exit/sale).
If \code{FALSE}, use \code{landExpectVal} (perpetuity) at the terminal year.}

\item{ShockSpec}{A \code{data.frame} defining drivers and low/high multipliers with
columns: \code{driver} (label), \code{type} (one of "flow_name","rate","terminal"),
\code{low_mult}, \code{high_mult}. See Details.}

\item{FlowNameMap}{Optional named list mapping the flow labels present in \code{Name}
to the friendly driver labels used in \code{ShockSpec}. Keys are the exact strings in
\code{Name}, values are the \code{driver} labels. If \code{NULL}, the function assumes
\code{driver} entries in \code{ShockSpec} directly match values of \code{Name}.}
}
\value{
A list with:
\itemize{
  \item \code{baseline_npv} Numeric scalar.
  \item \code{tornado_table} \code{data.frame} with columns
        \code{driver}, \code{low_delta}, \code{high_delta}, \code{range} (sorted).
  \item \code{plot} A ggplot object for the tornado chart.
  \item \code{assumptions} A list echoing key inputs and the \code{ShockSpec} used.
}
}
\description{
Computes a one-way tornado sensitivity by perturbing selected drivers
(flows by name, the discount rate, and/or terminal value) to low/high cases
while holding all other inputs fixed. Returns a sorted table of low/high
deltas versus baseline NPV and a ggplot object for the tornado chart.
}
\details{
Deterministic NPV is computed as the present value of the annual flow stream
plus a terminal component at \code{TerminalYear}. If \code{Exit = TRUE},
the terminal is discounted with \code{presentValue(FutureValue, TerminalYear, NominalRate)};
otherwise, \code{landExpectVal(FutureValue, TerminalYear, NominalRate)} is used.


\strong{ShockSpec} examples:
\preformatted{
data.frame(
  driver = c("Discount Rate", "Harvest Revenue", "Operating Costs", "Terminal Value"),
  type   = c("rate",          "flow_name",       "flow_name",       "terminal"),
  low_mult  = c(1.15,          0.85,              1.15,              0.85),
  high_mult = c(0.85,          1.15,              0.85,              1.15)
)
}
Low/high multipliers should reflect the intended directionality
(e.g., for costs you typically increase for "low" and decrease for "high").
}
\examples{
\dontrun{
ShockSpec <- data.frame(
  driver   = c("Discount Rate","Harvest Revenue","Operating Costs","Terminal Value"),
  type     = c("rate","flow_name","flow_name","terminal"),
  low_mult = c(1.15, 0.85, 1.15, 0.85),
  high_mult= c(0.85, 1.15, 0.85, 1.15)
)
out <- tornadoSensitivity(
  Flow = master_flows$Value,
  Occurrence = master_flows$Year,
  Name = master_flows$Name,
  NominalRate = discount_rate,
  TerminalYear = years,
  FutureValue = final_standing_value,
  Exit = TRUE,
  ShockSpec = ShockSpec,
  FlowNameMap = list(
    "Harvest Revenue"   = "Harvest Revenue",
    "Operating Expense" = "Operating Costs"
  )
)
out$plot
out$tornado_table
}
}
