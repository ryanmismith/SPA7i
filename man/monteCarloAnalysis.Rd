% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/montecarlofunction_norm_ou.R
\name{monteCarloAnalysis}
\alias{monteCarloAnalysis}
\title{Unified Monte Carlo NPV Simulation with Time-Dependent Stochastic Processes}
\usage{
monteCarloAnalysis(
  Flow,
  Occurrence = NULL,
  NominalRate,
  ProcessType = "normal",
  NumSimulations = 2000,
  Seed = 123,
  ApplyDiscounting = TRUE,
  SD_Flow = 0.2,
  SD_Discount = 0,
  sigma_infinity = 0.4,
  kappa = 0.15
)
}
\arguments{
\item{Flow}{Numeric vector of projected cash flows.}

\item{Occurrence}{Numeric vector of years for each flow.
\strong{Crucial for OU/Walk:} The vector must be sorted or grouped by year for the time-step logic to work most efficiently, though the code handles unsorted inputs by tracking `current_year`.
If \code{NULL}, defaults to Year 1 for all flows.}

\item{NominalRate}{Numeric. The nominal discount rate (e.g., 0.05).}

\item{ProcessType}{Character. \code{"normal"}, \code{"OU"}, or \code{"walk"}.}

\item{NumSimulations}{Integer. Number of iterations (default 2000).}

\item{Seed}{Integer. Sets the random seed. Change this when summing results from different asset classes to ensure independence.}

\item{ApplyDiscounting}{Logical. If \code{FALSE}, sets `NominalRate` to 0.}

\item{SD_Flow}{Numeric. Volatility parameter (Annual Standard Deviation).}

\item{SD_Discount}{Numeric. Standard deviation for the discount rate.}

\item{sigma_infinity}{Numeric. (OU Only) Long-run volatility cap.}

\item{kappa}{Numeric. (OU Only) Mean reversion speed.}
}
\value{
A list containing:
\describe{
  \item{NPVs}{Vector of simulated NPVs.}
  \item{CI_68/80/90}{Confidence intervals.}
  \item{variance_profile}{Data frame showing the theoretical risk evolution over time.}
}
}
\description{
This function performs a Monte Carlo simulation to estimate the Net Present Value (NPV)
of a cash flow stream. It supports three stochastic processes, two of which (`OU` and `walk`)
are \strong{time-dependent}, meaning they simulate a single market path that evolves over time.
}
\section{Critical Warning - Correlated Flows}{

For `OU` and `walk` processes, this function simulates \strong{one single market timeline} per simulation.
\itemize{
  \item \strong{Shared Deviations:} All cash flows occurring in the same year (e.g., Year 5 Timber Revenue AND Year 5 Hunting Lease) will receive the \strong{exact same percentage deviation}.
  \item \strong{Implication:} The function assumes all flows in the `Flow` vector are perfectly correlated (e.g., they are all driven by the same "Timber Price" index).
  \item \strong{How to Model Uncorrelated Assets:} If you have two uncorrelated revenue streams (e.g., Timber vs. Carbon Credits), you must run this function twice (once for each stream, using different `Seed` values) and sum the resulting NPV vectors.
}
}

\section{Process Types}{

The \code{ProcessType} argument controls the simulation logic:

\strong{1. "normal" (Independent Log-Normal)}
\itemize{
  \item \strong{Logic:} Index-based. Every single entry in the `Flow` vector gets a unique, independent random shock, even if they happen in the same year.
  \item \strong{Use Case:} Idiosyncratic risks (e.g., machine breakdowns, one-off costs) where Year 5's expense has no relationship to Year 5's revenue.
}

\strong{2. "OU" (Ornstein-Uhlenbeck / Mean Reversion)}
\itemize{
  \item \strong{Logic:} Time-based. The process evolves annually. If multiple flows occur in Year 5, the model advances the stochastic process to Year 5 \emph{once}, generates the market price deviation, and applies that \emph{same deviation} to all Year 5 flows.
  \item \strong{Use Case:} Commodity price modeling (Timber). High prices in Year 4 lead to mean-reverting pressure in Year 5, affecting all harvest activities in that year equally.
}

\strong{3. "walk" (Geometric Random Walk)}
\itemize{
  \item \strong{Logic:} Time-based. Similar to OU, the random walk evolves by year. Cumulative volatility grows with time. Includes a Jensen's Inequality correction to prevent artificial upward value drift.
  \item \strong{Use Case:} Inflationary costs or speculative asset prices where today's value is the baseline for tomorrow, and all cash flows in a given year face the same market conditions.
}
}

\examples{
# --- Example: Timber (OU) + Independent Costs (Normal) ---

# 1. Define Timber Revenue (Correlated market risk)
timber_flows <- c(5000, 15000)
timber_years <- c(10, 20)

sim_timber <- monteCarloAnalysis(
  Flow = timber_flows, Occurrence = timber_years, NominalRate = 0.05,
  ProcessType = "OU", Seed = 123
)

# 2. Define Road Costs (Independent operational risk)
cost_flows <- rep(-500, 20)
cost_years <- 1:20

sim_costs <- monteCarloAnalysis(
  Flow = cost_flows, Occurrence = cost_years, NominalRate = 0.05,
  ProcessType = "normal", Seed = 456 # Different seed!
)

# 3. Combine for Total Project NPV
total_npv <- sim_timber$NPVs + sim_costs$NPVs
quantile(total_npv, c(0.1, 0.9))

}
